#!/bin/bash
RUNAS="<%=@app[:run_as]%>"
BUCKET="<%=@app[:init][:s3_root]%>/<%=@app[:hostname]%>/backup"
export AWS_CONFIG_FILE="<%=@app[:run_as_home]%>/.aws/config"

# we sync only .enc files as a safeguard against accidentally uploading unencrypted content
aws s3 sync /var/cloudos/backup s3://$BUCKET --exclude '*' --include '*.enc'